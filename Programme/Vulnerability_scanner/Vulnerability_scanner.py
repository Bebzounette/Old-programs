#! usr/bin/env python

import scanner
import socket
import whois
from tabulate import tabulate
from colorama import init
from termcolor import colored
import wappalyze
import optparse
import pyfiglet



def get_arguments():
    parser = optparse.OptionParser()
    parser.add_option("-t", "--target", dest="target", help="website target")
    (options, arguments) = parser.parse_args()
    if not options.target:
        parser.error("[-] Please specify a target, use --help for more info")
    return options




ascii_banner = pyfiglet.figlet_format("Web Scanner\n By Zeckers")
print(ascii_banner)


options = get_arguments()

target_url = options.target
links_to_ignore = ["http://10.0.2.5/dvwa/logout.php"]
#dictionnary = {"username": "admin", "password": "password", "Login": "su

if "https" in target_url:
    new_url = target_url.replace('https://', '')
else:
    new_url = target_url.replace('http://', '')

get_ip = socket.gethostbyname(new_url)

domain = whois.whois(new_url)
tab = []
printing = wappalyze.analyze(target_url)
for x in printing.items():
    string = '\nCategory: '+str(x[0])+'\nFrameworks :'+','.join(x[1])
    tab.append(string)
proper_tab = '\n'.join(tab)


vuln_scanner = scanner.Scanner(target_url, links_to_ignore)
#vuln_scanner.session.post("http://10.0.2.5/dvwa/login.php", data=dictionnary)


print(colored(tabulate([["Target IP", "Domain Infos", "Technologies"], [get_ip, domain, proper_tab]], tablefmt="grid"), 'red', 'on_cyan'))
print("\n\n")

vuln_scanner.crawl()
vuln_scanner.run_scanner()